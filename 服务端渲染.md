## 服务端渲染（基础篇）

### 什么是渲染

我们这里所说的渲染指的是<strong>把（数据 + 模板）</strong>拼接到一起的这个事儿。

例如对于我们前端开发者来说最常见的一种场景就是：请求后端接口数据，然后将数据通过模板绑定语法绑定到页面中，最终呈现给用户。这个过程就是我们这里所指的渲染。

渲染本质其实就是字符串的解析替换，实现方式有很多种；但是我们这里要关注的并不是如何渲染，而是在哪里渲染的问题？


### 传统的服务端渲染

最早期，Web 页面渲染都是在服务端完成的，即服务端运行过程中将所需的数据结合页面模板渲染为HTML，响应给客户端浏览器。所以浏览器呈现出来的是直接包含内容的页面。

工作流程

![image](https://user-images.githubusercontent.com/37037802/137894723-97c00d2d-f37b-4c44-b10b-6d6eb4e905b5.png)

这种方式的代表性技术有：ASP、PHP、JSP，再到后来的一些相对高级一点的服务端框架配合一些模板引擎。这也就是最早的网页渲染方式，也就是动态网站的核心工作步骤。

在今天看来，这种渲染模式是不合理或者说不先进的。因为在当下这种网页越来越复杂的情况下，这种模式存在很多明显的不足：

  - 应用的前后端部分完全耦合在一起，在前后端协同开发方面会有非常大的阻力；
  - 前端没有足够的发挥空间，无法充分利用现在前端生态下的一些更优秀的方案；
  - 由于内容都是在服务端动态生成的，所以服务端的压力较大；
  - 相比目前流行的 SPA 应用来说，用户体验一般；

但是不得不说，在网页应用并不复杂的情况下，这种方式也是可取的。

### 客户端渲染

传统的服务端渲染有很多问题，但是这些问题随着客户端 Ajax 技术的普及得到了有效的解决，Ajax 技术可以使得客户端动态获取数据变为可能，也就是说原本服务端渲染这件事儿也可以拿到客户端做了。

下面是基于客户端渲染的 SPA 应用的基本工作流程。

![image](https://user-images.githubusercontent.com/37037802/137895287-39659571-fae9-4d8a-8e23-a8efaee7ba86.png)


通过这方式可以了解到我们就可以把【数据处理】和【页码渲染】这两件事儿分开了，也就是【后端】负责数据处理，【前端】负责页面渲染，这种分离模式极大的提高了开发效率和可维护性。

而且这样一来，【前端】更为独立，也不再受限制于【后端】，它可以选择任意的技术方案或框架来处理页面渲染。

但是这种模式下，也会存在一些明显的不足，其中最主要的就是：

  - 首屏渲染慢：因为 HTML 中没有内容，必须等到 JavaScript 加载并执行完成才能呈现页面内容。
  - SEO 问题：同样因为 HTML 中没有内容，所以对于目前的搜索引擎爬虫来说，页面中没有任何有用的信息，自然无法提取关键词，进行索引了。

对于客户端渲染的 SPA 应用的问题有没有解决方案呢？

  - 服务端渲染，严格来说是现代化的服务端渲染，也叫同构渲染

### 现代化的服务端渲染

SPA 应用有两个非常明显的问题：
  - 首屏渲染慢
  - 不利于 SEO

我们只是把问题抛出来了，那有没有解决办法呢？

答案就是：服务端渲染。

也就是将客户端渲染的工作放到服务端渲染，这个问题不就解决了吗？

但是有的同学肯定会想要问，是再让我们回到传统的服务端渲染吗？

不不不，本质上确实是需要使用到传统的服务端渲染，但是严格来讲应该叫现代化的服务端渲染，也叫同构渲染，也就是【服务端渲染】 + 【客户端渲染】。可能听起来有点晕，这个概念我们待会儿就会了解到。

- 基于 react、vue 框架，客户端渲染和服务器端渲染的结合，
  - 在服务器端执行一次，用于实现服务器端渲染（首屏直出）
  - 在客户端再执行一次，用于接管页面交互，
- 核心解决 SEO 和首屏渲染慢的问题。

![image](https://user-images.githubusercontent.com/37037802/137897423-8a2dffe9-5689-4d04-a202-54cfeda25cc5.png)

 1. 客户端发起请求

 2. 服务端渲染首屏内容 + 生成客户端 SPA 相关资源

 3. 服务端将生成的首屏资源发送给客户端
 
 5. 客户端直接展示服务端渲染好的首屏内容
 
 6. 首屏中的 SPA 相关资源执行之后会激活客户端 Vue
 
 8. 之后客户端所有的交互都由客户端 SPA 处理

分析优缺点：
- 优点：首屏渲染速度快、有利于 SEO
- 缺点：
  - 开发成本高。
  - 涉及构建设置和部署的更多要求。与可以部署在任何静态文件服务器上的完全静态单页面应用程序 (SPA) 不同，服务器渲染应用程序，需要处于 Node.js server 运行环境
  - 更多的服务器端负载。在 Node.js 中渲染完整的应用程序，显然会比仅仅提供静态文件的server 更加大量占用 CPU 资源 (CPU-intensive - CPU 密集)，因此如果你预料在高流量环境(high traffic) 下使  用，请准备相应的服务器负载，并明智地采用缓存策略

#### 相关技术
- React 生态中的 Next.js
- Vue 生态中的 Nuxt.js
- Angular 生态中的 Angular Universal

#### 实现原理：

![image](https://user-images.githubusercontent.com/37037802/137899203-a447615a-fdf1-4c4f-a301-9f9e7b6f96fc.png)
